@model EventPlanner.Web.Models.EventVm

@{
    ViewData["Title"] = "Event Details";
    bool isAuth = User.Identity?.IsAuthenticated == true;
}

<h2>@Model.Title</h2>
<p class="text-muted">@Model.Description</p>

<ul class="list-unstyled">
    <li><strong>Date:</strong> @Model.StartAtUtc.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</li>
    <li><strong>Location:</strong> @Model.LocationTitle</li>
    <li><strong>Available seats:</strong> @Model.AvailableSeats</li>
</ul>

<div class="mt-3 d-flex gap-2">
    <a asp-action="Index" class="btn btn-secondary">Back to list</a>

    @if (isAuth)
    {
        <form asp-controller="Ticket" asp-action="Book" method="get" class="d-inline">
            <input type="hidden" name="eventId" value="@Model.Id" />
            <button class="btn btn-primary" @(Model.AvailableSeats <= 0 ? "disabled" : "")>
                Book
            </button>
        </form>
    }
    else
    {
        @* Неавторизованный: ведём на Login с возвратом на эти детали *@
        @if (Model.AvailableSeats > 0)
        {
            <a asp-controller="Auth"
               asp-action="Login"
               asp-route-returnUrl="@Url.Action("Details", "Event", new { id = Model.Id })"
               class="btn btn-primary">
                Book
            </a>
        }
        else
        {
            <a class="btn btn-primary disabled" tabindex="-1" aria-disabled="true">Book</a>
        }
    }
</div>